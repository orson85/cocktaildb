<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='css/style.css'>
    <link rel="stylesheet" href="https://unpkg.com/open-props"/>
    <link rel="stylesheet" href="https://unpkg.com/open-props/normalize.min.css"/>
    <!--search-container button--><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
           
    
</head>
<body>

    
    <a id="back" href="./index.html">Back</a>
    
    <!-- AUS ABSTELLGELEIS -> LOESCHEN SOFERN NICHT UMGESETZT -->
    <!-- <script>
    //Schaut ob searchTerm in sessionStorage gespeichert. Wenn ja, wird der SearchTerm an den "Back"-Link angefügt.
    //Bei XY 
        if (sessionStorage.getItem("searchTerm") != null) {
            console.log(sessionStorage.getItem("searchTerm"))
            document.getElementById("back").href = `./index.html?${sessionStorage.getItem("searchTerm")}`
        }
    </script> -->
    <!-- ENDE: AUS ABSTELLGELEIS -> LOESCHEN SOFERN NICHT UMGESETZT -->
    
    
    Drink ID: <span id="drinkId"></span><br>
    <br>
    <img id="" src="" alt="">
    
    <b>Name:         </b>  <span id="strDrink"></span><br>
    <b>Ingredients:   </b>  <span id="strIngredient"></span><br>
    <b>Preparation:    </b>  <span id="strInstructions"></span><br>
    <div id="likeBtn"></div>       

<!--LIKE BUTTON-->




<script>
//NUR ENTWICKLUNG
sessionStorage.setItem("username", 'fdlksdjfdk' ); //nur zum Testing, ersetzen sobald Login steht
//sessionStorage.clear()
//NUR ENTWICKLUNG
</script>

<script>
//Like Button wird angezeigt, sofern username in sessionStorage enthalten.
if (sessionStorage.getItem("username") != null) {
    let button = document.createElement("input")
    button.setAttribute("id","like")
    button.setAttribute("type","button")
    button.setAttribute("value","Like")
    document.getElementById("likeBtn").appendChild(button)


    button.addEventListener('click', updateButton);
    }

    const button = document.getElementById("like");

    
    function updateButton() {
        if (button.value === 'Like') {
            button.value = 'Unlike';
        } else {
            button.value = 'Like';
        }
    }
</script>
<!--END LIKE BUTTON-->



<script>
//Alles um drinkId aus der URL zu lesen, die CocktailAPI abzufragen und Inhalte darzustellen.

        //Bestellung aufnehmen
        const drinkId = window.location.search; // Variable mit URL Param
        const url = `https://www.thecocktaildb.com/api/json/v1/1/lookup.php${drinkId}` //Fetch Request mit URL Param als Drink ID
        
        //Zutaten holen
        async function getData() {
            const response = await fetch(url);
            const data = await response.json();

            //ACHTUNG -> Untere Funktion muss noch ein NULL Check für Measures rein (siehe Vodka Fizz ID:169767
            // Array erstellen mit allen Zutaten & Measures, die nicht null sind (QuickNDirty)
            let ingredArr = [] 
            if (data.drinks[0].strIngredient1 != null ) { ingredArr.push(`${data.drinks[0].strMeasure1 } ${data.drinks[0].strIngredient1 }`)}
            if (data.drinks[0].strIngredient2 != null ) { ingredArr.push(`${data.drinks[0].strMeasure2 } ${data.drinks[0].strIngredient2 }`)}
            if (data.drinks[0].strIngredient3 != null ) { ingredArr.push(`${data.drinks[0].strMeasure3 } ${data.drinks[0].strIngredient3 }`)}
            if (data.drinks[0].strIngredient4 != null ) { ingredArr.push(`${data.drinks[0].strMeasure4 } ${data.drinks[0].strIngredient4 }`)}
            if (data.drinks[0].strIngredient5 != null ) { ingredArr.push(`${data.drinks[0].strMeasure5 } ${data.drinks[0].strIngredient5 }`)}
            if (data.drinks[0].strIngredient6 != null ) { ingredArr.push(`${data.drinks[0].strMeasure6 } ${data.drinks[0].strIngredient6 }`)}
            if (data.drinks[0].strIngredient7 != null ) { ingredArr.push(`${data.drinks[0].strMeasure7 } ${data.drinks[0].strIngredient7 }`)}
            if (data.drinks[0].strIngredient8 != null ) { ingredArr.push(`${data.drinks[0].strMeasure8 } ${data.drinks[0].strIngredient8 }`)}
            if (data.drinks[0].strIngredient9 != null ) { ingredArr.push(`${data.drinks[0].strMeasure9 } ${data.drinks[0].strIngredient9 }`)}
            if (data.drinks[0].strIngredient10 != null) { ingredArr.push(`${data.drinks[0].strMeasure10} ${data.drinks[0].strIngredient10}`)}
            if (data.drinks[0].strIngredient11 != null) { ingredArr.push(`${data.drinks[0].strMeasure11} ${data.drinks[0].strIngredient11}`)}
            if (data.drinks[0].strIngredient12 != null) { ingredArr.push(`${data.drinks[0].strMeasure12} ${data.drinks[0].strIngredient12}`)}
            if (data.drinks[0].strIngredient13 != null) { ingredArr.push(`${data.drinks[0].strMeasure13} ${data.drinks[0].strIngredient13}`)}
            if (data.drinks[0].strIngredient14 != null) { ingredArr.push(`${data.drinks[0].strMeasure14} ${data.drinks[0].strIngredient14}`)}
            if (data.drinks[0].strIngredient15 != null) { ingredArr.push(`${data.drinks[0].strMeasure15} ${data.drinks[0].strIngredient15}`)}
                // forEach der die Ingredients in ein Listenelement stopft und diese dann an den Span "strIngredient" anhängt.
                ingredArr.forEach(element => {
                item = document.createElement("li")
                item.append(element)
                document.getElementById("strIngredient").append(item)
                
            });

            //Mixen und servieren
            document.getElementById("drinkId").textContent = data.drinks[0].idDrink;
            document.getElementById("strDrink").textContent = data.drinks[0].strDrink;
            document.getElementById("strInstructions").textContent = data.drinks[0].strInstructions;
            document.querySelector("img").src=  data.drinks[0].strDrinkThumb       
        }

        window.onload = getData()
</script>


<script>
    //Favoritenliste User     
        //NACHHER IN EIGENES MODUL ÜBERTRAGEN
        const request = (path, options = {}, retries) =>
        fetch(`https://343505-26.web.fhgr.ch/api/gaming/${path}`, options)
        .then(res => {
          if (res.ok) {
            return res.json()
          }
          if (retries>0) {
            console.log(retries)
            return request(path, options, retries-1)
          }
        })
        .catch(error => console.error(error))
    
    
    const params = {"anythingelse..." : "{178332, 13196}"}
    const content = {method: 'GET', headers: { 'Content-Type': 'application/json' }}  
    //body: JSON.stringify(params)
    
    
    //API Request: Input = username aus SessionStorage, Output = Index des Users
    //Schaut welcher User "online" ist 
    let user = sessionStorage.username 
    
    //UserListe holen
    function getVal() {return request("user/0/", {method: 'GET', headers: { 'Content-Type': 'application/json' }}, 10)}
    
    //getUser = User holen, der in SessionStorage angegeben ist
    const getUser = getVal().then(res => {return res.find(element => element.username == user)})
    
    //getUserID
    const getUserID = getVal().then(res => {return res.find(element => element.username == user)}).then(e => {return(e.userid)})
    
    
    //getFavList = Favoritenliste des Users aus SessionStorage
    const getFavList = getUser.then(e => {return e["anythingelse..."]})
    //drinkIdURL = Drink ID aus URL-Param. In String umgewandelt & per Replace reine ID extrahiert.
    const drinkIdURL = JSON.stringify(window.location.search).replace(/[^0-9]/g,'')
    
    /*In der Favoritenliste des Users schauen, ob der auf der Seite angezeigte Drink bereits ein Favorit ist oder nicht.
    Wenn der Drink in der Liste vorkommt, wird beim Like Button der Wert auf "Unlike" gestellt */
    getFavList.then(e => {return e.split()}).then(e => (e.includes(drinkIdURL)) ? button.setAttribute("value","Unlike") : button.setAttribute("value","Like")
    )

    getUserID.then(userID => request(`user/${userID}`, {method: 'GET', headers: { 'Content-Type': 'application/json' }}, 10).then(e=>console.log(e)))
    
    console.log(button.value)

    button.value == "Like" ? console.log("true") : console.log("false")

    //ENDE: Favoritenliste User     
    </script>

</body>
</html>


